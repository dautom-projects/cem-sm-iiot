<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validación del flujo de datos de la plataforma :: CEMPRO Docs</title>
    <link rel="prev" href="troubleshooting.html">
    <meta name="generator" content="Antora 3.1.12">
    <link rel="stylesheet" href="./_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href=".">
        <img src="./_/img/logo.png" alt="Logo" class="navbar-logo" style="height: 44px; margin-right: 8px; vertical-align: middle;">
        CEMPRO Docs
      </a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Cempro</a></h3>
<ul class="nav-list">
  <li class="nav-item has-children" data-depth="0">
<ul class="nav-list">
  <li class="nav-item has-children" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Plataforma de datos IoT San Miguel</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="opc.html">Ignition como Cliente OPC UA</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ignition_mqtt.html">Modulo MQTT Transmission (Cirrus Link)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ibsnow.html">IoT Bridge for Snowflake (Cirrus Link)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="uns.html">Modelado UNS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting.html">Troubleshooting</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="validation.html">Validación de datos</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cempro</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Cempro</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Cempro</a></li>
    <li><a href="index.html">Plataforma de datos IoT San Miguel</a></li>
    <li><a href="validation.html">Validación de datos</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="file:///C:/Users/giljo/Desktop/DautomLocal/CEM/cem-sanmiguel/cem-sm-iiot/modules/ROOT/pages/validation.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Validación del flujo de datos de la plataforma</h1>
<div class="sect1">
<h2 id="_objetivo"><a class="anchor" href="#_objetivo"></a>Objetivo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Validar que un tag reporta el mismo valor (y marca de tiempo coherente) a lo largo del pipeline:
<strong>SCADA → Ignition → Snowflake</strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_alcance"><a class="anchor" href="#_alcance"></a>Alcance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Este procedimiento aplica a cualquier tag publicado en el UNS y transportado por el bridge hacia Snowflake.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerrequisitos"><a class="anchor" href="#_prerrequisitos"></a>Prerrequisitos</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Acceso al SCADA de planta.</p>
</li>
<li>
<p>Acceso al Ignition Designer (o Gateway + Tag Browser).</p>
</li>
<li>
<p>Acceso a Snowflake (rol/warehouse con permisos de lectura en tabla RAW).</p>
</li>
<li>
<p>Conocer el <strong>UNS Path</strong> del tag a validar.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_flujo_de_validación_paso_a_paso"><a class="anchor" href="#_flujo_de_validación_paso_a_paso"></a>Flujo de validación (paso a paso)</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visualizar la tag en el SCADA</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ubicar el tag objetivo en la pantalla correspondiente del SCADA.</p>
</li>
<li>
<p>Identificar tres datos: <strong>UNS Path</strong>, <strong>Timestamp</strong> visible en la UI y <strong>Valor</strong>.</p>
<div class="imageblock text-center unresolved">
<div class="content">
<img src="scada_tag_sample.png" alt="scada tag sample" width="800">
</div>
<div class="title">Figure 1. Captura de la tag en SCADA</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si el SCADA no muestra <strong>timestamp</strong>, anota la hora local exacta en la que observas el valor (incluye huso horario).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ver el dato en Ignition</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Abrir el <strong>Tag Browser</strong> y localizar el tag (mismo <strong>UNS Path</strong>).</p>
</li>
<li>
<p>Clic derecho sobre la tag → <strong>View Diagnostics</strong>.</p>
</li>
<li>
<p>Confirmar que el <strong>Name/Path</strong>, <strong>Timestamp</strong> y <strong>Value</strong> coinciden con lo observado en SCADA.</p>
<div class="imageblock text-center unresolved">
<div class="content">
<img src="ignition_diagnostic.png" alt="ignition diagnostic" width="800">
</div>
<div class="title">Figure 2. Ignition - View Diagnostics del tag</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En <strong>View Diagnostics</strong> puedes observar:
- <strong>Value</strong>: valor actual y calidad.
- <strong>Timestamp</strong>: marca de tiempo del último valor.
- <strong>OPC Item</strong> y <strong>Server</strong> si aplica (útil para rastrear la fuente).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ver el dato en Snowflake</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Usar la marca de tiempo identificada y el <strong>UNS Path</strong> (o fragmento del path) para consultar la tabla RAW.</p>
</li>
<li>
<p>Ejecutar una consulta como la siguiente (ajusta <strong>EDGE_NODE_ID</strong>, <strong>MSG LIKE</strong> y la ventana temporal):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- SPARKPLUG_RAW
SELECT
  TO_TIMESTAMP_TZ(INSERTED_AT/1000) AS TS,
  *
FROM CL_BRIDGE_STAGE_DB.STAGE_DB.SPARKPLUG_RAW
WHERE TS &gt;= DATEADD(hour, -24, CURRENT_TIMESTAMP())
  AND EDGE_NODE_ID = 'San Miguel'
  AND MSG LIKE '%Coke/Setpoint_Kilogramos_Coke%'
  AND MSG LIKE '%1756700957875%'   -- (timestamp/ID dentro del payload si aplica)
ORDER BY TS DESC
LIMIT 100;</code></pre>
</div>
</div>
<div class="imageblock text-center unresolved">
<div class="content">
<img src="snowflake_raw_query.png" alt="snowflake raw query" width="900">
</div>
<div class="title">Figure 3. Query de verificación en Snowflake RAW</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Zona horaria</strong>: <strong>INSERTED_AT</strong> normalmente llega en milisegundos (epoch) y <strong>TS</strong> se muestra en UTC. Convierte a la hora local para comparar con SCADA/Ignition.</p>
</li>
<li>
<p><strong>Filtrado por contenido</strong>: <code>MSG</code> guarda el payload Sparkplug B. Usa <code>LIKE</code> con el <strong>UNS Path</strong> parcial y, cuando sea posible, un identificador de tiempo/medición para afinar resultados.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_criterios_de_aceptación"><a class="anchor" href="#_criterios_de_aceptación"></a>Criterios de aceptación</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>El <strong>Valor</strong> observado en SCADA coincide con el valor en Ignition.</p>
</li>
<li>
<p>El <strong>Valor</strong> e información del payload en Snowflake corresponden a la misma medición (considerando conversión horaria).</p>
</li>
<li>
<p>La <strong>Calidad/Quality</strong> del tag en Ignition es <strong>Good</strong> (o equivalente).</p>
</li>
<li>
<p>Si el valor cambió, se evidencian los nuevos valores en los tres sistemas dentro de un intervalo razonable.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solución_de_problemas_rápidos"><a class="anchor" href="#_solución_de_problemas_rápidos"></a>Solución de problemas (rápidos)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>No aparece en Snowflake</strong>: amplía la ventana <code>DATEADD</code>, y confirma <strong>EDGE_NODE_ID</strong> y <strong>UNS Path</strong>. Verifica el estado del bridge y latencia.</p>
</li>
<li>
<p><strong>Timestamps no coinciden</strong>: valida huso horario (UTC vs local) y desfases de NTP en servidores.</p>
</li>
<li>
<p><strong>Valor distinto en Ignition vs SCADA</strong>: revisa <strong>OPC Item Path</strong> y <strong>Server</strong> en <strong>View Diagnostics</strong>; puede existir un mapeo obsoleto.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_evidencia_sugerida"><a class="anchor" href="#_evidencia_sugerida"></a>Evidencia sugerida</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Incluye en el reporte final:
- Captura de pantalla del SCADA con la tag resaltada.
- Captura de <strong>View Diagnostics</strong> en Ignition.
- Resultado de la consulta en Snowflake (tabla o captura con <strong>TS</strong>, <strong>UNS Path</strong> y <strong>Value</strong>).
- Breve nota de equivalencia horaria (UTC ↔ local).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anexo_plantilla_de_consulta"><a class="anchor" href="#_anexo_plantilla_de_consulta"></a>Anexo: plantilla de consulta</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Usa esta plantilla y reemplaza los marcadores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT
  TO_TIMESTAMP_TZ(INSERTED_AT/1000) AS TS,
  *
FROM &lt;DB&gt;.&lt;SCHEMA&gt;.SPARKPLUG_RAW
WHERE TS BETWEEN :start_ts_utc AND :end_ts_utc
  AND EDGE_NODE_ID = :edge
  AND MSG LIKE CONCAT('%', :uns_fragment, '%')
  /* Opcional: anclar por ID/ts interno del payload */
  AND MSG LIKE CONCAT('%', :payload_anchor, '%')
ORDER BY TS DESC
LIMIT 200;</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="troubleshooting.html">Troubleshooting</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="./_/js/site.js" data-ui-root-path="./_"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
  <script src="./_/js/vendor/lunr.min.js"></script> 

<script src="./_/js/vendor/lunr.stemmer.support.js"></script> 

<script src="./_/js/vendor/lunr.es.js"></script> 

<script src="./_/js/07-search.js"></script> 

 

 
</html>
